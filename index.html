---
layout: page
---
<div class="container-fluid">
  <div class="row">
    <div id="buttons" class="col-md-12 text-right" style="margin-bottom:10px;"></div>
    <div class="col-md-12">
      <table id="dashboard" class="table table-striped table-bordered nowrap" cellspacing="0" width="100%">
      </table>
    </div>
  </div>
</div>

<script>
$(function() {
  // *** onload ***

  // build dashboard
  var dashboard = $('#dashboard').DataTable({
    initComplete: function(settings, json) {
      // add print, excel, column visibility buttons
      $("#dashboard").DataTable().buttons().container().appendTo( $('#buttons'));
      
      // required due to incompatiblity with fixedcolumns and scroller extensions
      setTimeout(function() {$("#dashboard").DataTable().columns.adjust().draw(); }, 10);
    },
    ajax: function(data, callback, settings) {
      // load the data -- for testing use: $.getJSON("{{ site.url }}/test-data/sample-event-scores.json", function(teamData) {
      $('.loaderImage').show();

      ParadoxScout.getEventScoutingData(null, function(teamData, error) {
        
        $('.loaderImage').hide();

        if(error) {
          AppUtility.showErrorMsg("An error occurred!", error);
        }
        else {
          callback({
            data: teamData, 
            destroy: true,
            initComplete: function(settings, json) {
              setTimeout(function() {$("#dashboard").DataTable().columns.adjust().draw(); }, 500);
            }
          });
        }
      });
    },
    // responsive: true,
    // pageLength: 25,
    paging: false,
    scrollY:450,
    scrollX:true,
    scrollCollapse: true,
    fixedColumns: true,
    colReorder: {
        fixedColumnsLeft: 1
    },
    order: [[ 1, "desc" ]], // default sort set to total_points | desc 
    buttons: [ { extend: 'colvis', title: 'Columns' },'print', { extend: 'excel', title: 'Excel' } ],
    columns: [
      { title: 'Team', data: 'team_number', 
        render: function(data,type,full,meta) { 
          if (type === 'display') {
            return '<span style="padding-right:15px;width:200px;">' + full.team_name + '</span>' +
              '[ <a style="color:#D59E2A;" href="{{ site.url }}/rate?team_id=' + full.team_key + '"><i class="fa fa-star-o"></i></a> | ' +
              '<a style="color:#D5482A"href="{{ site.url }}/team-details?team_id=' + full.team_key + '"><i class="fa fa-info-circle"></i></a> | ' +
              '<a style="color:#D59E2A;" href="{{ site.url }}/scouting-reports?team_id=' + full.team_key + '"><i class="fa fa-files-o"></i></a> ]' 
          }
          else {
            return data;
          }
        } 
      },
      // totals
      { title: 'Total', data: 'totalPoints', orderSequence: ['desc', 'asc'] },
      { title: 'Teleop Total', data: 'teleopPoints', orderSequence: ['desc', 'asc'] },
      { title: 'Auto Total', data: 'autoPoints', orderSequence: ['desc', 'asc'] },
      // ranking info
      { title: 'Rank', data: 'ranking', orderSequence: ['desc', 'asc'] },
      { title: 'Ranking Score', data: 'rankingScore', orderSequence: ['desc', 'asc'] },
      { title: 'Auto', data: 'rankingAuto', orderSequence: ['desc', 'asc'] }, 
      { title: 'Scale Challenge', data: 'rankingScaleChallenge', orderSequence: ['desc', 'asc'] },
      { title: 'Goals', data: 'rankingGoals', orderSequence: ['desc', 'asc'] },
      { title: 'Def.', data: 'rankingDef', orderSequence: ['desc', 'asc'] }, 

      // statistical rankings
      { title: 'OPRS', data: 'oprs', orderSequence: ['desc', 'asc'], render: function(data) { return Math.round(data*100)/100; } },
      { title: 'CCWMS', data: 'ccwms', orderSequence: ['desc', 'asc'], render: function(data) { return Math.round(data*100)/100; } },
      { title: 'DPRS', data: 'dprs', orderSequence: ['desc', 'asc'], render: function(data) { return Math.round(data*100)/100; } },
      // offense
      { title: 'Boulder Points', data: 'teleopBoulderPoints', orderSequence: ['desc', 'asc'], 
        render: function(data,type,full,meta) { return full.autoBoulderPoints + full.teleopBoulderPoints } 
      },
      { title: 'High Goal', data: 'teleopBouldersHigh', orderSequence: ['desc', 'asc'], 
        render: function(data,type,full,meta) { return full.autoBouldersHigh + full.teleopBouldersHigh } 
      },
      { title: 'Low Goal', data: 'teleopBouldersLow', orderSequence: ['desc', 'asc'], 
        render: function(data,type,full,meta) { return full.autoBouldersLow + full.teleopBouldersLow } 
      },
      { title: 'Crossing Points', data: 'teleopChallengePoints', orderSequence: ['desc', 'asc'], 
        render: function(data,type,full,meta) { return full.autoCrossingPoints + full.teleopCrossingPoints } 
      },
      // obstacles
      { title: 'Pos.1 X Count', data: 'position1crossings', orderSequence: ['desc', 'asc'], defaultContent:0 },
      { title: 'ChevalDeFrise X Count', data: 'A_ChevalDeFrise', orderSequence: ['desc', 'asc'], defaultContent:0 },
      { title: 'Drawbridge X Count', data: 'C_Drawbridge', orderSequence: ['desc', 'asc'], defaultContent:0 },
      { title: 'Moat Count X Count', data: 'B_Moat', orderSequence: ['desc', 'asc'], defaultContent:0 },
      { title: 'Portcullis X Count', data: 'A_Portcullis', orderSequence: ['desc', 'asc'], defaultContent:0 },
      { title: 'Ramparts X Count', data: 'B_Ramparts', orderSequence: ['desc', 'asc'], defaultContent:0 },
      { title: 'RockWall X Count', data: 'D_RockWall', orderSequence: ['desc', 'asc'], defaultContent:0 },
      { title: 'RoughTerrain X Count', data: 'D_RoughTerrain', orderSequence: ['desc', 'asc'], defaultContent:0 },
      { title: 'SallyPort X Count', data: 'C_SallyPort', orderSequence: ['desc', 'asc'], defaultContent:0 },
      // other
      { title: 'Auto Reach Points', data: 'autoReachPoints', orderSequence: ['desc', 'asc'] },
      { title: 'Teleop Challenge Points', data: 'teleopChallengePoints', orderSequence: ['desc', 'asc'] },
      { title: 'Teleop Scale Points', data: 'teleopScalePoints', orderSequence: ['desc', 'asc'] },
      { title: 'Teleop Defenses Breached', data: 'teleopDefensesBreached', orderSequence: ['desc', 'asc'] },
      { title: 'Teleop Tower Captured', data: 'teleopTowerCaptured', orderSequence: ['desc', 'asc'] },
      { title: 'Breach Points', data: 'breachPoints', orderSequence: ['desc', 'asc'] },
      { title: 'CapturePoints', data: 'capturePoints', orderSequence: ['desc', 'asc'] },
      { title: 'Tower End Strength', data: 'towerEndStrength', orderSequence: ['desc', 'asc'] },
      { title: 'Adjust Points', data: 'adjustPoints', orderSequence: ['desc', 'asc'] },
      { title: 'Foul Points', data: 'foulPoints', orderSequence: ['desc', 'asc'] },
      { title: 'Foul Count', data: 'foulCount', orderSequence: ['desc', 'asc'] },
      { title: 'Tech Foul Count', data: 'techFoulCount', orderSequence: ['desc', 'asc'] },
    ],
    'columnDefs': [{
      'defaultContent': '-',
      'targets': '_all'
    }]
  });

  // make column header sticky
  //new $.fn.dataTable.FixedHeader(dashboard, { headerOffset: $('#main-menu').height() });

  // look for updated event scores every 30 sec.
  setInterval( function () {
    dashboard.ajax.reload( null, false ); // user paging is not reset on reload
  }, 30000 );

});
</script>
