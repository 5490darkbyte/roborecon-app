---
layout: page
---
<div class="container">
  <div class="row">
    <div class="col-md-12">
      Dashboard here
      <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
      </table>
    </div>
  </div>
</div>

<script>
$(function() {
  // build the dashboard
  $.getJSON("{{ site.url }}/sample-event-scores.json", function(teamData) {
    // build an object that contains one record per team
    var teams = {};

    $.each(teamData, function(teamKey, teamDetails) {
      // get list of matches
      var matches = teamDetails.scores;

      $.each(matches, function(matchKey, match) {

        if(teams.hasOwnProperty(teamKey)) {
          // if team exists in 'teams', sum existing scoring category values
          $.each(match, function(scoringCategoryKey, scoringCategoryValue) {
            // if looking at teamKey or matchTime, continue to next item
            if(scoringCategoryKey == 'team_key' || scoringCategoryKey == 'match_time') return true;

            if ($.isNumeric(scoringCategoryValue)) {
              teams[teamKey][scoringCategoryKey] += match[scoringCategoryKey];
            }
            else if (typeof(JSON.parse(scoringCategoryValue)) == 'boolean') {
              var currentVal = JSON.parse(teams[teamKey][scoringCategoryKey]);
              var newVal = JSON.parse(match[scoringCategoryKey]);

              teams[teamKey][scoringCategoryKey] = currentVal + newVal;
            }
          });
        }
        else {
          teams[teamKey] = match;
          teams[teamKey].team_key = teamKey;
        }
      });
    });

    // conver teams object into an array for datatables
    var teamsArray = $.map(teams, function(item) { return item; });

    var dashboard = $('#example').DataTable({
      responsive: true,
      'data': teamsArray,
      'columns': [
        { title: 'Team', data: 'team_key' },
        { title: 'Total', data: 'total_points' },
        { title: 'adjust_points', data: 'adjust_points' },
        { title: 'auto_points', data: 'auto_points' },
        { title: 'container_count_level1', data: 'container_count_level1' },
        { title: 'container_count_level2', data: 'container_count_level2' },
        { title: 'container_count_level3', data: 'container_count_level3' },
        { title: 'container_count_level4', data: 'container_count_level4' },
        { title: 'container_count_level5', data: 'container_count_level5' },
        { title: 'container_count_level6', data: 'container_count_level6' },
        { title: 'container_points', data: 'container_points' },
        { title: 'container_set', data: 'container_set' },
        { title: 'foul_count', data: 'foul_count' },
        { title: 'foul_points', data: 'foul_points' },
        { title: 'litter_count_container', data: 'litter_count_container' },
        { title: 'litter_count_landfill', data: 'litter_count_landfill' },
        { title: 'litter_count_unprocessed', data: 'litter_count_unprocessed' },
        { title: 'litter_points', data: 'litter_points' },
        { title: 'robot_set', data: 'robot_set' },
        { title: 'teleop_points', data: 'teleop_points' },
        { title: 'tote_count_far', data: 'tote_count_far' },
        { title: 'tote_count_near', data: 'tote_count_near' },
        { title: 'tote_points', data: 'tote_points' },
        { title: 'tote_set', data: 'tote_set' },
        { title: 'tote_stack', data: 'tote_stack' }
      ],
      'columnDefs': [{
        'defaultContent': '-',
        'targets': '_all'
      }]
    });

    new $.fn.dataTable.FixedHeader(dashboard, {headerOffset: 100});

  });

});
</script>
